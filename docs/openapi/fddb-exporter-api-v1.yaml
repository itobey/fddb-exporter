openapi: 3.0.3
info:
  title: FDDB Exporter API v1 (DEPRECATED)
  description: |
    **⚠️ DEPRECATED: This API version is deprecated and will be removed after 2026-06-30.**
    
    Please migrate to v2 API. See migration guide: /docs/migration/v1-to-v2.md
    
    REST API for the FDDB Exporter application - Version 1 (Legacy).
    
    This API provides endpoints for:
    - Querying FDDB nutrition data entries
    - Exporting data from FDDB for specified date ranges
    - Retrieving statistics and rolling averages
    - Managing data migrations between storage backends
    - Calculating correlations between data series
    
    All v1 endpoints return `X-API-Deprecated: true` header.
  version: '1.0.0'
  contact:
    name: FDDB Exporter
    url: https://github.com/itobey/fddb-exporter
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8080/api/v1
    description: Local development server (v1 - DEPRECATED)
  - url: https://api.example.com/api/v1
    description: Production server (v1 - DEPRECATED)

tags:
  - name: fddb-data
    description: FDDB nutrition data operations (DEPRECATED)
  - name: correlation
    description: Correlation analysis (DEPRECATED)

paths:
  /fddbdata:
    get:
      deprecated: true
      tags:
        - fddb-data
      summary: Get all FDDB data entries (DEPRECATED)
      description: |
        **DEPRECATED:** Use GET /api/v2/fddbdata instead.
        
        Retrieves all FDDB nutrition data entries from the database.
      operationId: findAllEntriesV1
      responses:
        '200':
          description: Successful operation
          headers:
            X-API-Deprecated:
              schema:
                type: string
                example: 'true'
              description: Indicates this API is deprecated
            Link:
              schema:
                type: string
                example: '</docs/migration/v1-to-v2.md>; rel="help"; title="Migrate to v2"'
              description: Link to migration documentation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FddbDataDTO'
        '503':
          description: MongoDB not available

    post:
      deprecated: true
      tags:
        - fddb-data
      summary: Export data for a date range (DEPRECATED)
      description: |
        **DEPRECATED:** Use POST /api/v2/fddbdata instead.
        
        Export FDDB data for all days in the specified timeframe.
      operationId: exportForTimerangeV1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DateRangeDTO'
      responses:
        '200':
          description: Export completed successfully
          headers:
            X-API-Deprecated:
              schema:
                type: string
                example: 'true'
            Link:
              schema:
                type: string
                example: '</docs/migration/v1-to-v2.md>; rel="help"; title="Migrate to v2"'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportResultDTO'
        '400':
          description: Invalid date range

  /fddbdata/{date}:
    get:
      deprecated: true
      tags:
        - fddb-data
      summary: Get FDDB data for a specific date (DEPRECATED)
      description: |
        **DEPRECATED:** Use GET /api/v2/fddbdata/{date} instead.
        
        Retrieves FDDB data entries for the specified date.
      operationId: findByDateV1
      parameters:
        - name: date
          in: path
          required: true
          description: Date in YYYY-MM-DD format
          schema:
            type: string
            pattern: '^\d{4}-\d{2}-\d{2}$'
            example: '2024-12-22'
      responses:
        '200':
          description: Data found for the specified date
          headers:
            X-API-Deprecated:
              schema:
                type: string
                example: 'true'
            Link:
              schema:
                type: string
                example: '</docs/migration/v1-to-v2.md>; rel="help"; title="Migrate to v2"'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FddbDataDTO'
        '400':
          description: Invalid date format
        '404':
          description: No data found for the specified date
        '503':
          description: MongoDB not available

  /fddbdata/products:
    get:
      deprecated: true
      tags:
        - fddb-data
      summary: Search products by name (DEPRECATED)
      description: |
        **DEPRECATED:** Use GET /api/v2/fddbdata/products instead.
        
        Search for FDDB products by name across all dates.
      operationId: findByProductV1
      parameters:
        - name: name
          in: query
          required: true
          description: Product name to search for
          schema:
            type: string
            example: 'Banana'
      responses:
        '200':
          description: Search results
          headers:
            X-API-Deprecated:
              schema:
                type: string
                example: 'true'
            Link:
              schema:
                type: string
                example: '</docs/migration/v1-to-v2.md>; rel="help"; title="Migrate to v2"'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProductWithDateDTO'
        '503':
          description: MongoDB not available

  /fddbdata/export:
    get:
      deprecated: true
      tags:
        - fddb-data
      summary: Export data for recent days (DEPRECATED)
      description: |
        **DEPRECATED:** Use GET /api/v2/fddbdata/export instead.
        
        Export FDDB data for a specified number of days back from today.
      operationId: exportForDaysBackV1
      parameters:
        - name: days
          in: query
          required: true
          description: Number of days to export
          schema:
            type: integer
            minimum: 1
            example: 7
        - name: includeToday
          in: query
          required: false
          description: Whether to include today in the export
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Export completed successfully
          headers:
            X-API-Deprecated:
              schema:
                type: string
                example: 'true'
            Link:
              schema:
                type: string
                example: '</docs/migration/v1-to-v2.md>; rel="help"; title="Migrate to v2"'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportResultDTO'

  /fddbdata/stats:
    get:
      deprecated: true
      tags:
        - fddb-data
      summary: Get overall statistics (DEPRECATED)
      description: |
        **DEPRECATED:** Use GET /api/v2/stats instead.
        
        Retrieves overall statistics for FDDB data.
      operationId: getStatsV1
      responses:
        '200':
          description: Statistics retrieved successfully
          headers:
            X-API-Deprecated:
              schema:
                type: string
                example: 'true'
            Link:
              schema:
                type: string
                example: '</docs/migration/v1-to-v2.md>; rel="help"; title="Migrate to v2"'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatsDTO'
        '503':
          description: MongoDB not available

  /fddbdata/stats/averages:
    get:
      deprecated: true
      tags:
        - fddb-data
      summary: Get rolling averages (DEPRECATED)
      description: |
        **DEPRECATED:** Use GET /api/v2/stats/averages instead.
        
        Calculate rolling averages for a specified date range.
      operationId: getRollingAveragesV1
      parameters:
        - name: fromDate
          in: query
          required: true
          description: Start date in YYYY-MM-DD format
          schema:
            type: string
            pattern: '^\d{4}-\d{2}-\d{2}$'
            example: '2024-01-01'
        - name: toDate
          in: query
          required: true
          description: End date in YYYY-MM-DD format
          schema:
            type: string
            pattern: '^\d{4}-\d{2}-\d{2}$'
            example: '2024-12-31'
      responses:
        '200':
          description: Rolling averages calculated successfully
          headers:
            X-API-Deprecated:
              schema:
                type: string
                example: 'true'
            Link:
              schema:
                type: string
                example: '</docs/migration/v1-to-v2.md>; rel="help"; title="Migrate to v2"'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RollingAveragesDTO'
        '400':
          description: Invalid date range
        '503':
          description: MongoDB not available

  /fddbdata/migrateToInfluxDb:
    post:
      deprecated: true
      tags:
        - fddb-data
      summary: Migrate data to InfluxDB (DEPRECATED)
      description: |
        **DEPRECATED:** Use POST /api/v2/fddbdata/migration/toInfluxDb instead.
        
        Migrate all MongoDB entries to InfluxDB.
      operationId: migrateToInfluxDbV1
      responses:
        '200':
          description: Migration completed successfully
          headers:
            X-API-Deprecated:
              schema:
                type: string
                example: 'true'
            Link:
              schema:
                type: string
                example: '</docs/migration/v1-to-v2.md>; rel="help"; title="Migrate to v2"'
          content:
            application/json:
              schema:
                type: string
                example: 'Migrated 150 entries to InfluxDB'
        '503':
          description: MongoDB or InfluxDB not available

  /correlation:
    post:
      deprecated: true
      tags:
        - correlation
      summary: Create correlation analysis (DEPRECATED)
      description: |
        **DEPRECATED:** Use POST /api/v2/correlation instead.
        
        Calculate correlation between two data series.
      operationId: createCorrelationV1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CorrelationInputDto'
      responses:
        '200':
          description: Correlation calculated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CorrelationOutputDto'

components:
  schemas:
    FddbDataDTO:
      type: object
      description: FDDB nutrition data for a specific date
      properties:
        date:
          type: string
          format: date
          example: '2024-12-22'
        products:
          type: array
          items:
            $ref: '#/components/schemas/ProductDTO'
        totalCalories:
          type: number
          format: double
        totalProtein:
          type: number
          format: double
        totalCarbs:
          type: number
          format: double
        totalFat:
          type: number
          format: double

    ProductDTO:
      type: object
      description: A single food product with nutritional information
      properties:
        name:
          type: string
          example: 'Banana'
        amount:
          type: number
          format: double
        unit:
          type: string
          example: 'g'
        calories:
          type: number
          format: double
        protein:
          type: number
          format: double
        carbs:
          type: number
          format: double
        fat:
          type: number
          format: double

    ProductWithDateDTO:
      type: object
      description: Product with the date it was consumed
      properties:
        date:
          type: string
          format: date
        product:
          $ref: '#/components/schemas/ProductDTO'

    DateRangeDTO:
      type: object
      description: Date range specification
      required:
        - fromDate
        - toDate
      properties:
        fromDate:
          type: string
          format: date
          example: '2024-01-01'
        toDate:
          type: string
          format: date
          example: '2024-12-31'

    ExportResultDTO:
      type: object
      description: Result of an export operation
      properties:
        savedEntries:
          type: integer
          description: Number of new entries saved
        updatedEntries:
          type: integer
          description: Number of existing entries updated
        errors:
          type: array
          items:
            type: string

    StatsDTO:
      type: object
      description: Overall statistics for FDDB data
      properties:
        totalEntries:
          type: integer
        totalProducts:
          type: integer
        averageCaloriesPerDay:
          type: number
          format: double
        averageProteinPerDay:
          type: number
          format: double
        averageCarbsPerDay:
          type: number
          format: double
        averageFatPerDay:
          type: number
          format: double

    RollingAveragesDTO:
      type: object
      description: Rolling averages for a date range
      properties:
        fromDate:
          type: string
          format: date
        toDate:
          type: string
          format: date
        averageCalories:
          type: number
          format: double
        averageProtein:
          type: number
          format: double
        averageCarbs:
          type: number
          format: double
        averageFat:
          type: number
          format: double
        dataPoints:
          type: integer
          description: Number of days included in the calculation

    CorrelationInputDto:
      type: object
      description: Input for correlation analysis
      properties:
        seriesA:
          type: array
          items:
            type: number
            format: double
        seriesB:
          type: array
          items:
            type: number
            format: double
        method:
          type: string
          enum: [ PEARSON, SPEARMAN ]
          default: PEARSON

    CorrelationOutputDto:
      type: object
      description: Result of correlation analysis
      properties:
        correlationCoefficient:
          type: number
          format: double
          description: Correlation coefficient between -1 and 1
        pValue:
          type: number
          format: double
          description: Statistical significance
        method:
          type: string
          enum: [ PEARSON, SPEARMAN ]
        sampleSize:
          type: integer

